<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Stage Grid</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Orbit controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // Enable inertia
        controls.dampingFactor = 0.05;

        // Light stage parameters
        const numLightBoards = 10; // 346
        const radius = 10; // Radius of the unit sphere

        // Colors for the lights
        const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffa500]; // Red, Green, Blue, Amber

        // Function to create a snowflake-shaped light board
        function createSnowflake() {
            const snowflake = new THREE.Group();

            // Center hexagon of 12 white lights
            const hexagonRadius = 0.5;
            const whiteMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const x = Math.cos(angle) * hexagonRadius;
                const y = Math.sin(angle) * hexagonRadius;
                const light = new THREE.Mesh(new THREE.SphereGeometry(0.1, 8, 8), whiteMaterial);
                light.position.set(x, y, 0);
                snowflake.add(light);
            }

            // 6 branches with 4 colored lights at the end forming a diamond
            const branchLength = 1.5;
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2;
                const x = Math.cos(angle) * branchLength;
                const y = Math.sin(angle) * branchLength;
                for (let j = 0; j < 4; j++) {
                    const color = colors[j];
                    const light = new THREE.Mesh(new THREE.SphereGeometry(0.1, 8, 8), new THREE.MeshBasicMaterial({ color }));
                    const offsetAngle = angle + (j / 4) * Math.PI * 2 / 6;
                    light.position.set(x + Math.cos(offsetAngle) * 0.3, y + Math.sin(offsetAngle) * 0.3, 0);
                    snowflake.add(light);
                }
            }

            return snowflake;
        }

        // Position the light boards on a unit sphere
        for (let i = 0; i < numLightBoards; i++) {
            const theta = Math.acos(1 - 2 * (i + 0.5) / numLightBoards);
            const phi = Math.PI * (1 + Math.sqrt(5)) * (i + 0.5);
            const x = radius * Math.sin(theta) * Math.cos(phi);
            const y = radius * Math.sin(theta) * Math.sin(phi);
            const z = radius * Math.cos(theta);

            const snowflake = createSnowflake();
            snowflake.position.set(x, y, z);
            scene.add(snowflake);
        }

        camera.position.z = 20;

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
